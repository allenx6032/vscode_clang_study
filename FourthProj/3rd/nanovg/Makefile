# 编译器和工具
CC = gcc
CXX =g++
AR = ar
CFLAGS = -std=c11 -w -O3 -g -static -D_UNICODE -DUNICODE -D__UNICODE__ -DWIN32 -D_WIN32 -D__WIN32__ -D_WINDOWS -DWINDOWS -D__WINDOWS__ -D_GLFW_WIN32 -DNANOVG_GLEW -DGLEW_STATIC -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -D_CRT_SECURE_NO_WARNINGS -DLUA_COMPAT -DLUA_COMPAT_ALL -DLUA_COMPAT_5_3 -DLUA_COMPAT_5_2  -DFT2_BUILD_LIBRARY -DFT_CONFIG_OPTION_SYSTEM_ZLIB -DBUILDING_LIBCURL -DCURL_HIDDEN_SYMBOLS -DHAVE_CURL_CONFIG_H -DCURL_STATICLIB -DSFML_STATIC -DAL_BUILD_LIBRARY -DAL_LIBTYPE_STATIC -DAL_ALEXT_PROTOTYPES -DFLAC__CPU_X86_64 -DFLAC__HAS_X86INTRIN -DFLAC__ALIGN_MALLOC_DATA -DFLAC__NO_DLL -DFLAC__OVERFLOW_DETECT -DFLAC__HAS_OGG -DFLAC__ENABLE_64_BIT_WORDS  -DLOAD_PNG -DLOAD_JPG -DLOAD_WEBP -DLOAD_GIF -DCC_STATIC -DHAVE_FAAD_CONFIG_H
CXXFLAGS = -std=c++14 -w -O3 -g -static -D_UNICODE -DUNICODE -D__UNICODE__ -DWIN32 -D_WIN32 -D__WIN32__ -D_WINDOWS -DWINDOWS -D__WINDOWS__ -D_GLFW_WIN32 -DNANOVG_GLEW -DGLEW_STATIC -D_CRT_SECURE_NO_DEPRECATE -D_CRT_NONSTDC_NO_DEPRECATE -D_CRT_SECURE_NO_WARNINGS -DLUA_COMPAT -DLUA_COMPAT_ALL -DLUA_COMPAT_5_3 -DLUA_COMPAT_5_2  -DFT2_BUILD_LIBRARY -DFT_CONFIG_OPTION_SYSTEM_ZLIB -DBUILDING_LIBCURL -DCURL_HIDDEN_SYMBOLS -DHAVE_CURL_CONFIG_H -DCURL_STATICLIB -DSFML_STATIC -DAL_BUILD_LIBRARY -DAL_LIBTYPE_STATIC -DAL_ALEXT_PROTOTYPES -DFLAC__CPU_X86_64 -DFLAC__HAS_X86INTRIN -DFLAC__ALIGN_MALLOC_DATA -DFLAC__NO_DLL -DFLAC__OVERFLOW_DETECT -DFLAC__HAS_OGG -DFLAC__ENABLE_64_BIT_WORDS  -DLOAD_PNG -DLOAD_JPG -DLOAD_WEBP -DLOAD_GIF -DCC_STATIC -DHAVE_FAAD_CONFIG_H
ARFLAGS = rcs

# 目录和文件
SRC_DIR = .
OBJ_DIR = .
LIB_DIR = ../../lib
INCLUDE_DIR = .
INCLUDE_DIR += ../
INCLUDE_DIR += ../../header
LIB_NAME = nanovg


ifeq ($(OS),Windows_NT)
SOURCEDIRS	:= $(SRC_DIR)
INCLUDEDIRS	:= $(INCLUDE_DIR)
LIBDIRS		:= $(LIB_DIR)
FIXPATH = $(subst /,\,$1)
RM			:= del
TARGET 		:=  /s /q /f
MD	:= mkdir
else
SOURCEDIRS	:= $(shell find $(SRC_DIR) -type d)
INCLUDEDIRS	:= $(shell find $(INCLUDE_DIR) -type d)
LIBDIRS		:= $(shell find $(LIB_DIR) -type d)
FIXPATH = $1
RM = rm 
TARGET 		:= -f
MD	:= mkdir -p
endif


# 自动获取所有源文件并生成目标文件列表
C_SRCS = $(wildcard $(patsubst %,%/*.c, $(SOURCEDIRS)))
CPP_SRCS =$(wildcard $(patsubst %,%/*.cpp, $(SOURCEDIRS)))
CXX_SRCS = $(wildcard $(patsubst %,%/*.cxx, $(SOURCEDIRS)))
CC_SRCS = $(wildcard $(patsubst %,%/*.cc, $(SOURCEDIRS)))
C_OBJS = $(C_SRCS:.c=.o)
CPP_OBJS = $(CPP_SRCS:.cpp=.o)
CXX_OBJS = $(CXX_SRCS:.cxx=.o)
CC_OBJS = $(CC_SRCS:.cc=.o)
C_DEPS	:= $(C_OBJS:.o=.d)
CPP_DEPS:= $(CPP_OBJS:.o=.d)
CXX_DEPS:= $(CXX_OBJS:.o=.d)
CC_DEPS	:= $(CC_OBJS:.o=.d)
INCLUDES:= $(patsubst %,-I%, $(INCLUDEDIRS:%/=%))
LIBS	:= $(patsubst %,-L%, $(LIBDIRS:%/=%))
LIB = $(LIB_DIR)/lib$(LIB_NAME).a

# 默认目标
all: $(LIB)

# 生成静态库
$(LIB): $(C_OBJS) $(CPP_OBJS) $(CXX_OBJS) $(CC_OBJS)
	$(AR) $(ARFLAGS) $@ $^

-include $(C_DEPS) $(CPP_DEPS) $(CXX_DEPS) $(CC_DEPS)
# 生成目标文件
%.o:%.c
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c -MMD $< -o  $@
%.o:%.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES)  -c -MMD $< -o $@
%.o:%.cxx
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c -MMD $< -o $@
# 声明支持的源文件后缀
# .SUFFIXES: .cc .o
%.o:%.cc
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c -MMD $< -o $@
	
# 清理生成的文件
clean:
	rm -rf *.o *.d $(LIB)

.PHONY: all clean

